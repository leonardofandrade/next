{% extends '_global/layout/base.html' %}

{% block page_title %}
<i class="fas fa-user-shield text-primary me-2"></i>
{{ page_title|default:"Usuário Extrator" }}
{% endblock page_title %}

{% block page_description %}
{{ page_description|default:"Gerencie permissões de acesso do extrator." }}
{% endblock page_description %}

{% block page_actions %}
<a href="{% if request.GET.next %}{{ request.GET.next }}{% else %}{% url 'core:extraction_agency_hub' %}{% endif %}" class="btn btn-outline-secondary me-2">
  <i class="fas fa-arrow-left me-2"></i>Voltar
</a>
{% endblock page_actions %}

{% block content %}
<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card">
        <div class="card-body">
          <form method="post" novalidate>
            {% csrf_token %}

            {% if form.non_field_errors %}
              <div class="alert alert-danger">{{ form.non_field_errors }}</div>
            {% endif %}

            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="border-bottom pb-2 mb-0">
                  <i class="fas fa-user me-2"></i>Usuário
                </h6>
              </div>
              <div class="col-md-8">
                <label for="{{ form.user.id_for_label }}" class="form-label">{{ form.user.label }}</label>
                {{ form.user }}
                {% if form.user.errors %}<div class="text-danger">{{ form.user.errors }}</div>{% endif %}
                {% if form.user.field.disabled %}
                  <div class="form-text">O usuário não pode ser alterado na edição.</div>
                {% endif %}
              </div>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-12">
                <h6 class="border-bottom pb-2 mb-0">
                  <i class="fas fa-sitemap me-2"></i>Acesso às Unidades
                </h6>
                <div class="text-muted small mt-1">Marque as unidades que este extrator poderá acessar.</div>
              </div>

              <div class="col-12">
                {% if form.extraction_units.errors %}
                  <div class="text-danger mb-2">{{ form.extraction_units.errors }}</div>
                {% endif %}

                <div class="row g-2">
                  {% for checkbox in form.extraction_units %}
                    <div class="col-md-4">
                      <div class="form-check">
                        {{ checkbox.tag }}
                        <label class="form-check-label" for="{{ checkbox.id_for_label }}">
                          {{ checkbox.choice_label }}
                        </label>
                      </div>
                    </div>
                  {% empty %}
                    <div class="col-12">
                      <div class="alert alert-warning mb-0">Nenhuma unidade disponível para esta agência.</div>
                    </div>
                  {% endfor %}
                </div>

                {% if form.extraction_units.help_text %}
                  <div class="form-text">{{ form.extraction_units.help_text }}</div>
                {% endif %}
              </div>
            </div>

            <div class="d-flex justify-content-between">
              <a href="{% if request.GET.next %}{{ request.GET.next }}{% else %}{% url 'core:extraction_agency_hub' %}{% endif %}" class="btn btn-secondary">
                <i class="fas fa-times me-2"></i>Cancelar
              </a>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Salvar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
